<script>
// ====== CONFIGURATION SECTION - Edit these values ======
const CONFIG = {
  // API endpoints
  apiEndpoint: 'https://api-staging.flite.city/api/geteventsbyhost/sway-hospitality',

  // URL patterns
  eventDetailUrlPattern: 'https://flite.city/e/{slug}', // Use {slug} as a placeholder

  // Visual settings
  cardsPerRow: {
    desktop: 3,    // Number of cards per row on large screens
    tablet: 2,     // Number of cards per row on medium screens
    mobile: 1      // Number of cards per row on small screens
  },

  // Text settings
  headings: {
    upcoming: "Upcoming Events",
    past: "Past Events",
    noUpcoming: "No upcoming events found.",
    noPast: "No past events found.",
    noEvents: "No events found.",
    error: "Unable to load events at this time. Please try again later."
  },

  // Button settings
  buttons: {
    showPast: "Show Past Events",
    hidePast: "Hide Past Events",
    viewDetails: "View Details",
    viewHistory: "View Event"
  }
};
// ====== END CONFIGURATION SECTION ======

document.addEventListener("DOMContentLoaded", function () {
  // Create container for upcoming events
  const upcomingEventsContainer = document.createElement("div");
  upcomingEventsContainer.className = "events-grid upcoming-events";
  upcomingEventsContainer.style.display = "grid";
  upcomingEventsContainer.style.gridTemplateColumns = `repeat(auto-fill, minmax(calc(100% / ${CONFIG.cardsPerRow.desktop} - 20px), 1fr))`;
  upcomingEventsContainer.style.gap = "20px";
  upcomingEventsContainer.style.padding = "20px";

  // Create container for past events
  const pastEventsContainer = document.createElement("div");
  pastEventsContainer.className = "events-grid past-events";
  pastEventsContainer.style.display = "grid";
  pastEventsContainer.style.gridTemplateColumns = `repeat(auto-fill, minmax(calc(100% / ${CONFIG.cardsPerRow.desktop} - 20px), 1fr))`;
  pastEventsContainer.style.gap = "20px";
  pastEventsContainer.style.padding = "20px";
  pastEventsContainer.style.marginTop = "40px";

  // Create heading for past events
  const pastHeading = document.createElement("h2");
  pastHeading.textContent = CONFIG.headings.past;
  pastHeading.style.gridColumn = "1 / -1";
  pastHeading.style.margin = "0 0 20px 0";
  pastHeading.style.fontSize = "28px";
  pastHeading.style.color = "#ffffff";
  pastEventsContainer.appendChild(pastHeading);

  // Function to create event card
  function createEventCard(event, isPast) {
    // Create event card
    const eventCard = document.createElement("div");
    eventCard.className = isPast ? "event-card past-event" : "event-card";
    eventCard.style.border = "1px solid #333";
    eventCard.style.borderRadius = "8px";
    eventCard.style.overflow = "hidden";
    eventCard.style.boxShadow = "0 4px 10px rgba(0,0,0,0.5)";
    eventCard.style.backgroundColor = "#222";
    eventCard.style.transition = "transform 0.3s ease, box-shadow 0.3s ease";

    if (isPast) {
      eventCard.style.opacity = "0.6";
      eventCard.style.filter = "grayscale(80%)";
    }

    // Add event image if available
    if (event.hostFlyer && event.hostFlyer.length > 0) {
      const eventImage = document.createElement("img");
      eventImage.src = event.hostFlyer[0];
      eventImage.alt = event.eventName;
      eventImage.style.width = "100%";
      eventImage.style.height = "200px";
      eventImage.style.objectFit = "cover";
      eventCard.appendChild(eventImage);
    }

    // Add event details
    const eventDetails = document.createElement("div");
    eventDetails.className = "event-details";
    eventDetails.style.padding = "15px";

    // Event name
    const eventName = document.createElement("h3");
    eventName.textContent = event.eventName;
    eventName.style.margin = "0 0 10px 0";
    eventName.style.fontSize = "18px";
    eventName.style.color = isPast ? "#aaa" : (event.color || "#fff");
    eventDetails.appendChild(eventName);

    // Event date and time
    const eventDateTime = document.createElement("p");
    const startDate = new Date(event.startDateTime);
    const options = {
      weekday: 'long',
      year: 'numeric',
      month: 'long',
      day: 'numeric',
      hour: '2-digit',
      minute: '2-digit'
    };
    eventDateTime.textContent = startDate.toLocaleDateString('en-US', options);
    eventDateTime.style.margin = "5px 0";
    eventDateTime.style.fontSize = "14px";
    eventDateTime.style.color = "#ccc";
    eventDetails.appendChild(eventDateTime);

    // Venue
    const eventVenue = document.createElement("p");
    eventVenue.textContent = event.venueName;
    eventVenue.style.margin = "5px 0";
    eventVenue.style.fontSize = "14px";
    eventVenue.style.fontWeight = "bold";
    eventVenue.style.color = "#ccc";
    eventDetails.appendChild(eventVenue);

    // Location
    const eventLocation = document.createElement("p");
    eventLocation.textContent = event.venueLocation;
    eventLocation.style.margin = "5px 0 15px 0";
    eventLocation.style.fontSize = "14px";
    eventLocation.style.color = "#999";
    eventDetails.appendChild(eventLocation);

    // Function to calculate contrast color for text (black or white)
    function getContrastColor(hexColor) {
      // Convert hex to RGB
      let color = hexColor.replace('#', '');

      // Handle shorthand hex (#fff)
      if (color.length === 3) {
        color = color.split('').map(c => c + c).join('');
      }

      const r = parseInt(color.substr(0, 2), 16);
      const g = parseInt(color.substr(2, 2), 16);
      const b = parseInt(color.substr(4, 2), 16);

      // Calculate relative luminance (WCAG formula)
      const luminance = (0.299 * r + 0.587 * g + 0.114 * b) / 255;

      // Return black for light backgrounds, white for dark backgrounds
      return luminance > 0.5 ? '#000' : '#fff';
    }

    // View details button
    const viewButton = document.createElement("a");
    const detailUrl = CONFIG.eventDetailUrlPattern.replace('{slug}', event.slug);
    viewButton.href = detailUrl;
    viewButton.textContent = isPast ? CONFIG.buttons.viewHistory : CONFIG.buttons.viewDetails;
    viewButton.style.display = "inline-block";
    viewButton.style.padding = "8px 16px";
    const buttonBgColor = isPast ? "#555" : (event.color || "#007bff");
    viewButton.style.backgroundColor = buttonBgColor;
    viewButton.style.color = getContrastColor(buttonBgColor);
    viewButton.style.textDecoration = "none";
    viewButton.style.borderRadius = "4px";
    viewButton.style.fontWeight = "bold";
    viewButton.style.marginTop = "10px";
    viewButton.style.boxShadow = "0 2px 5px rgba(0,0,0,0.3)";
    eventDetails.appendChild(viewButton);
  

    // Add details to card
    eventCard.appendChild(eventDetails);

    return eventCard;
  }

  // Fetch events from API
  fetch(CONFIG.apiEndpoint)
    .then(response => response.json())
    .then(data => {
      if (data.success && data.data) {
        const now = new Date();
        let upcomingEvents = [];
        let pastEvents = [];

        // Sort events into upcoming and past
        if (data.data.upcomingEvents) {
          upcomingEvents = data.data.upcomingEvents.filter(event =>
            new Date(event.endDateTime) >= now
          );
        }

        if (data.data.pastEvents) {
          pastEvents = data.data.pastEvents;
        } else if (data.data.upcomingEvents) {
          // If past events aren't provided separately, filter from upcoming
          pastEvents = data.data.upcomingEvents.filter(event =>
            new Date(event.endDateTime) < now
          );
        }

        // Sort upcoming events by start date (closest first)
        upcomingEvents.sort((a, b) =>
          new Date(a.startDateTime) - new Date(b.startDateTime)
        );

        // Sort past events by start date (most recent first)
        pastEvents.sort((a, b) =>
          new Date(b.startDateTime) - new Date(a.startDateTime)
        );

        // Display upcoming events
        if (upcomingEvents.length > 0) {
          upcomingEvents.forEach(event => {
            const eventCard = createEventCard(event, false);
            upcomingEventsContainer.appendChild(eventCard);
          });
        } else {
          const noUpcomingEvents = document.createElement("p");
          noUpcomingEvents.textContent = CONFIG.headings.noUpcoming;
          noUpcomingEvents.style.textAlign = "center";
          noUpcomingEvents.style.gridColumn = "1 / -1";
          noUpcomingEvents.style.padding = "40px";
          noUpcomingEvents.style.fontSize = "18px";
          noUpcomingEvents.style.color = "#ccc";
          upcomingEventsContainer.appendChild(noUpcomingEvents);
        }

        // Display past events
        if (pastEvents.length > 0) {
          pastEvents.forEach(event => {
            const eventCard = createEventCard(event, true);
            pastEventsContainer.appendChild(eventCard);
          });
        } else {
          const noPastEvents = document.createElement("p");
          noPastEvents.textContent = CONFIG.headings.noPast;
          noPastEvents.style.textAlign = "center";
          noPastEvents.style.gridColumn = "1 / -1";
          noPastEvents.style.padding = "40px";
          noPastEvents.style.fontSize = "18px";
          noPastEvents.style.color = "#ccc";
          pastEventsContainer.appendChild(noPastEvents);
        }
      } else {
        // Display message if no events
        const noEvents = document.createElement("p");
        noEvents.textContent = CONFIG.headings.noEvents;
        noEvents.style.textAlign = "center";
        noEvents.style.gridColumn = "1 / -1";
        noEvents.style.padding = "40px";
        noEvents.style.fontSize = "18px";
        noEvents.style.color = "#ccc";
        upcomingEventsContainer.appendChild(noEvents);
      }
    })
    .catch(error => {
      console.error('Error fetching events:', error);
      const errorMessage = document.createElement("p");
      errorMessage.textContent = CONFIG.headings.error;
      errorMessage.style.textAlign = "center";
      errorMessage.style.gridColumn = "1 / -1";
      errorMessage.style.padding = "40px";
      errorMessage.style.fontSize = "18px";
      errorMessage.style.color = "#ff5555";
      upcomingEventsContainer.appendChild(errorMessage);
    });

  // Add containers to the page
  const eventsSection = document.querySelector("#events-section");
  eventsSection.appendChild(upcomingEventsContainer);

  // Add toggle button for past events
  const toggleButton = document.createElement("button");
  toggleButton.textContent = CONFIG.buttons.showPast;
  toggleButton.style.display = "block";
  toggleButton.style.margin = "20px auto";
  toggleButton.style.padding = "10px 20px";
  toggleButton.style.backgroundColor = "#333";
  toggleButton.style.color = "#fff";
  toggleButton.style.border = "1px solid #444";
  toggleButton.style.borderRadius = "4px";
  toggleButton.style.cursor = "pointer";
  toggleButton.style.fontSize = "16px";
  toggleButton.style.transition = "background-color 0.3s ease";

  // Add hover effect for toggle button
  toggleButton.addEventListener("mouseover", function () {
    this.style.backgroundColor = "#444";
  });

  toggleButton.addEventListener("mouseout", function () {
    this.style.backgroundColor = "#333";
  });

  // Initially hide past events
  pastEventsContainer.style.display = "none";

  // Toggle past events visibility
  toggleButton.addEventListener("click", function () {
    if (pastEventsContainer.style.display === "none") {
      pastEventsContainer.style.display = "grid";
      this.textContent = CONFIG.buttons.hidePast;
      // Smooth scroll to past events section
      pastEventsContainer.scrollIntoView({ behavior: 'smooth' });
    } else {
      pastEventsContainer.style.display = "none";
      this.textContent = CONFIG.buttons.showPast;
    }
  });


  // Apply responsive grid adjustments
  function adjustGridForScreenSize() {
    const width = window.innerWidth;
    let columns;

    if (width < 768) {
      columns = CONFIG.cardsPerRow.mobile;
    } else if (width < 1024) {
      columns = CONFIG.cardsPerRow.tablet;
    } else {
      columns = CONFIG.cardsPerRow.desktop;
    }

    const columnValue = `repeat(auto-fill, minmax(calc(100% / ${columns} - 20px), 1fr))`;
    upcomingEventsContainer.style.gridTemplateColumns = columnValue;
    pastEventsContainer.style.gridTemplateColumns = columnValue;
  }

  // Initial adjustment
  adjustGridForScreenSize();

  // Listen for window resize
  window.addEventListener('resize', adjustGridForScreenSize);
});
</script>

<style>
#events-section {
  background-color: #000;
  color: #fff;
  padding: 20px 0;
}

.events-grid {
  margin: 0 auto;
  max-width: 1200px;
}

.event-card {
  background-color: #222;
  border: 1px solid #333;
  box-shadow: 0 4px 10px rgba(0,0,0,0.5);
}

.event-card:hover {
  transform: translateY(-5px);
  transition: transform 0.3s ease, box-shadow 0.3s ease;
  box-shadow: 0 8px 20px rgba(0,0,0,0.7), 0 0 15px rgba(255,255,255,0.1);
  border: 1px solid #444;
}

.past-event:hover {
  transform: translateY(-3px);
}

@media (max-width: 1024px) {
  .events-grid {
    grid-template-columns: repeat(2, 1fr);
  }
}

@media (max-width: 768px) {
  .events-grid {
    grid-template-columns: 1fr;
  }
}
</style>

<!-- Place this div where you want the events to appear -->
<div id="events-section"></div>